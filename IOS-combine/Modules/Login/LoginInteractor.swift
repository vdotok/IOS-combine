//
//  LoginInteractor.swift
//  IOS-combine
//
//  Created by usama farooq on 30/08/2021.
//  Copyright (c) 2021 ___ORGANIZATIONNAME___. All rights reserved.
//
//  This file was generated by the üêç VIPER generator
//

import Foundation

final class LoginInteractor: BaseDataStore {
    
    let translator: ObjectTranslator
    
    init(service: Service, translator: ObjectTranslator = ObjectTranslation()) {
        self.translator = translator
        super.init(service: service)
    }
    
}

// MARK: - Extensions -

extension LoginInteractor: LoginInteractorInterface {
    func login(with request: LoginRequest, complition: @escaping loginComplition) {
        service.get(request: request) { result in
            switch result {
            case .success(let data):
                self.translate(data: data, complition: complition)
            case .failure(let error):
                print(error)
            }
        }
    }
    private func translate(data: Data, complition: loginComplition) {
        do {
            let response: UserResponse = try translator.decodeObject(data: data)
            switch response.status {
            case 200:
                VDOTOKObject<UserResponse>().setData(response)
                VDOTOKObject<String>().setToken(response.authToken)
                
            default:
                break
            }
            complition(.success(response))
            
        }
        catch {
            complition(.failure(error))
        }
    }

    
}
